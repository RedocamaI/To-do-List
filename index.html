<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="to_do_styles.css" rel="stylesheet" />
    <title>To-do List</title>
  </head>
  <body>
    <div class="container largest" id="blur">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">To-do List</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" href="index.html">My list</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="developer.html">About Developer</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div class="quote">
        <h1>Live in the moment!</h1>
      </div>

      <div class="container my-4" id="describe_box">
        <form>
          <div class="form-row align-items-center">
            <button
              type="submit"
              id="add"
              class="btn btn-primary my-2 btn_plus"
            >
              +
            </button>
            <input
              type="text"
              class="form-control mb-1"
              style="width: 40%"
              id="title"
              placeholder="Title"
            />

            <textarea
              class="form-control"
              id="description"
              placeholder="Describe it"
              style="width: auto"
            ></textarea>
            <form action="/action_page.php">
              <div id="due">
                <h5 style="margin-bottom: 0px; width: 50%">Due date</h5>
                <input type="date" id="due_date" />
              </div>
            </form>
          </div>
        </form>
      </div>

      <div class="container my-4" id="list_box">
        <div class="row">
          <i class="col-10">My TODOs</i>
        </div>
        <div class="container my-4" id="items" style="width: 100%; padding: 0">
          <table class="table table-hover" style="width: 100%">
            <thead>
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Due on</th>
              </tr>
            </thead>
            <tbody id="table_body" style="width: 100%">
              <tr id="todos" onclick="view()">
                <td id="table_data">Title here!</td>
                <td>Due on</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="container" id="pop-up-window_desc">
      <h2>Description</h2>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"
    ></script>

    <script>
      let D;
      function ReceivenUpdate() {
        console.log("Updating List...");
        let tit = document.getElementById("title").value;
        let desc = document.getElementById("description").value;
        let date_value = document.getElementById("due_date").value;
        D = Date.parse(date_value);
        let str_date = String(date_value);
        let display_date = changeformatt(str_date);
        // Calculate the difference between the due date and today:
        let Today = Date.parse(new Date());
        let diff = D - Today;

        if (!tit || !desc || str_date.length == 0) {
          alert("Fill something in the title, description, and due date");
        } else {
          if (diff <= -86400000) {
            // DESCRIBE: Why you've taken diff to be less than '-86400000'!
            alert("Please enter a valid date!");
          } else if (localStorage.getItem("itemsJson") == null) {
            itemJsonArray = [];
            itemJsonArray.push([tit, desc, display_date]);
            localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));
          } else {
            itemJsonArrayStr = localStorage.getItem("itemsJson");
            itemJsonArray = JSON.parse(itemJsonArrayStr);
            itemJsonArray.push([tit, desc, display_date]);
            localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));
          }
          SetnUpdate();
        }
      }

      function SetnUpdate() {
        if (localStorage.getItem("itemsJson") == null) {
          itemJsonArray = [];
          localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));
        } else {
          itemJsonArrayStr = localStorage.getItem("itemsJson");
          itemJsonArray = JSON.parse(itemJsonArrayStr);
        }
        // Populate the table:
        let tableBody = document.getElementById("table_body");
        let list = "";
        itemJsonArray.forEach((element, index) => {
          list += `
                  <tr onclick="view(${index})">
                    <td id="table_data" style="width: auto;">${element[0]}</td>
                    <td id="table_data">${element[2]}</td>
                  </tr>`;
        });
        tableBody.innerHTML = list;
      }
      add = document.getElementById("add");
      add.addEventListener("click", ReceivenUpdate);
      SetnUpdate();

      function Delete(item) {
        console.log("Deleted", item);
        let blur = document.getElementById("blur");
        let pop_up = document.getElementById("pop-up-window_desc");
        if (confirm("Are you sure, you want to delete the current item?")) {
          itemJsonArraystr = localStorage.getItem("itemsJson");
          itemJsonArray = JSON.parse(itemJsonArraystr);
          // Delete the clicked item in the list.
          itemJsonArray.splice(item, 1);
          localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));
          SetnUpdate();
          blur.classList.toggle("active");
          pop_up.classList.toggle("active");
        }
      }

      function New_list() {
        if (itemJsonArray.length != 0) {
          if (
            confirm(
              "By creating a new one you will be clearing the current list. Do you want to continue?"
            )
          ) {
            localStorage.clear();
            SetnUpdate();
          }
        } else {
          alert("New list is already present!");
        }
      }

      function changeformatt(date) {
        let currentDate = new Date(date);
        var fd = currentDate.toDateString();
        return fd;
      }

      // toggle between two classes:
      function view(item) {
        let blur = document.getElementById("blur");
        blur.classList.toggle("active");
        let pop_up = document.getElementById("pop-up-window_desc");
        pop_up.innerHTML =
          `<h2>Description</h2>` +
          itemJsonArray[item][1] +
          `<br><a href='#' id="close" onclick='view(${item})'>Close</a>
                                                                            <a href='#' id="delete" onclick='Delete(${item})'>Delete</a>`;
        pop_up.classList.toggle("active");
      }
    </script>
  </body>
</html>
